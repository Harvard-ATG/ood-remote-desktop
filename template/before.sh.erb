#!/bin/bash

this_script="template/before.sh.erb"

log() {
    echo -e "[$(date -Iseconds)][${this_script}] $1"
}

# Validate home directory and set it to what it should be
log "original HOME=$HOME"
log "user=$(id -nu)"
export HOME="/shared/home/$(id -nu)"
log "new HOME=$HOME"

export SING_OVERLAYS=""

## create custom desktop folder
export DESKTOP_FOLDER="${PWD}/desktop"
export XDG_DESKTOP_DIR=$DESKTOP_FOLDER
mkdir -p $DESKTOP_FOLDER
log "Set up desktop folder"

## create the configuration folder
export XDG_CONFIG_HOME=$PWD/config
mkdir -p $XDG_CONFIG_HOME
export XDG_CONFIG_DIRS=$XDG_CONFIG_HOME
log "Set up config folder"

## we set a separate desktop folder, but unique Documents , etc etc 
cat > $XDG_CONFIG_DIRS/user-dirs.dirs  <<EOF
XDG_DESKTOP_DIR="$DESKTOP_FOLDER"
XDG_DOCUMENTS_DIR="$HOME/Documents"
XDG_DOWNLOAD_DIR="$HOME/Downloads"
XDG_MUSIC_DIR="$HOME/Music"
XDG_PICTURES_DIR="$HOME/Pictures"
XDG_PUBLICSHARE_DIR="$HOME/Public"
XDG_TEMPLATES_DIR="$HOME/Templates"
XDG_VIDEOS_DIR="$HOME/Videos"
EOF
log "Set up user dirs folder"
